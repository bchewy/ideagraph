## Codebase Patterns
- Next.js 16 with App Router, src directory, TypeScript
- Tailwind CSS v4 configured via PostCSS (`@tailwindcss/postcss`)
- shadcn/ui initialized with `components.json`, components live in `src/components/ui/`
- Path alias `@/*` maps to `src/*`
- `npm run typecheck` runs `npx tsc --noEmit`
- Geist font loaded via `next/font/google` in root layout
- Drizzle ORM with better-sqlite3: connection in `src/lib/db/index.ts`, schema in `src/lib/db/schema.ts`
- drizzle.config.ts points schema to `./src/lib/db/schema.ts`, migrations output to `./drizzle/`
- SQLite database file at `./sqlite.db` (gitignored), WAL mode enabled
- Use `npx drizzle-kit generate` for migrations, `npx drizzle-kit push` to apply during dev
- Drizzle SQLite schema: `text('snake_case')` for text, `integer('snake_case')` for ints, camelCase for TS

---

## 2026-02-03 - US-001
- Scaffolded Next.js 16.1.6 project with App Router, TypeScript, Tailwind CSS v4
- Initialized shadcn/ui with Button and Card components
- Updated root layout with IdeaGraph metadata
- Updated home page to use shadcn/ui components
- Files changed: package.json, tsconfig.json, next.config.ts, postcss.config.mjs, eslint.config.mjs, next-env.d.ts, .gitignore, src/app/layout.tsx, src/app/page.tsx, src/app/globals.css, src/lib/utils.ts, src/components/ui/button.tsx, src/components/ui/card.tsx, components.json
- **Learnings for future iterations:**
  - create-next-app refuses to run in a directory with existing files — scaffold in /tmp and copy over
  - shadcn/ui v3.8+ supports Tailwind v4 natively, uses `@theme inline` CSS syntax
  - Turbopack shows a root warning when a parent directory also has a package-lock.json (benign)
---

## 2026-02-03 - US-002
- Installed drizzle-orm, better-sqlite3, drizzle-kit, @types/better-sqlite3
- Created drizzle.config.ts for SQLite dialect with schema at src/lib/db/schema.ts
- Created src/lib/db/index.ts with better-sqlite3 connection (WAL mode)
- Created src/lib/db/schema.ts (empty placeholder for US-003)
- Added *.db to .gitignore
- Files changed: package.json, package-lock.json, drizzle.config.ts, src/lib/db/index.ts, src/lib/db/schema.ts, .gitignore
- **Learnings for future iterations:**
  - Drizzle ORM v0.x uses `drizzle({ client: sqlite })` pattern for better-sqlite3
  - drizzle-kit uses `defineConfig` with `dialect: 'sqlite'` (not `driver`)
  - Enable WAL mode via `sqlite.pragma('journal_mode = WAL')` for better concurrent read performance
---

## 2026-02-03 - US-003
- Defined `projects` table: id (text PK), name (text), createdAt (integer)
- Defined `documents` table: id (text PK), projectId (FK → projects.id), filename, openaiFileId (nullable), status (default 'pending'), sizeBytes, createdAt
- Generated migration via `npx drizzle-kit generate` → drizzle/0000_smooth_daredevil.sql
- Applied migration via `npx drizzle-kit push`
- Files changed: src/lib/db/schema.ts, drizzle/0000_smooth_daredevil.sql, drizzle/meta/
- **Learnings for future iterations:**
  - `npx drizzle-kit generate` creates SQL migration files in the `drizzle/` directory
  - `npx drizzle-kit push` applies schema directly to the database (good for development)
  - Drizzle SQLite uses `text('column_name')` and `integer('column_name')` with snake_case DB names
---

## 2026-02-03 - US-004
- Defined `nodes` table: id, projectId (FK), label, summary, tags (JSON text default '[]'), createdAt
- Defined `edges` table: id, projectId (FK), sourceNodeId (FK → nodes), targetNodeId (FK → nodes), type, confidence (real), createdAt
- Defined `evidenceRefs` table: id, nodeId (FK nullable), edgeId (FK nullable), documentId (FK), excerpt, locator (nullable)
- Defined `jobs` table: id, projectId (FK), type, status (default 'pending'), error (nullable), createdAt, completedAt (nullable)
- Generated migration drizzle/0001_wooden_unus.sql, applied with push
- Files changed: src/lib/db/schema.ts, drizzle/0001_wooden_unus.sql, drizzle/meta/
- **Learnings for future iterations:**
  - Use `real('column')` from drizzle-orm/sqlite-core for floating-point columns (e.g., confidence scores)
  - Tags stored as JSON text with `text('tags').default('[]')` — parse with JSON.parse on read
  - evidenceRefs uses nullable nodeId and edgeId to associate with either entity
---
